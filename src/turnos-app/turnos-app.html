<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/events-calendar/events-calendar.html">
<link rel="import" href="../../bower_components/neon-animation/neon-animated-pages.html">
<link rel="import" href="../../bower_components/neon-animation/neon-animation.html">
<link rel="import" href="../../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-styles/color.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/paper-date-picker/paper-date-picker.html">
<link rel="import" href="../../bower_components/vaadin-date-picker/vaadin-date-picker.html">
<link rel="import" href="../../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../bower_components/paper-time-picker/paper-time-picker.html">
<link rel="import" href="../../bower_components/paper-date-picker-item/paper-date-picker-item.html">
<link rel="import" href="../../bower_components/paper-date-picker-item/paper-datetime-picker-item.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<script src="../../bower_components/moment/min/locales.js"></script>
<script src="../../bower_components/sugar/dist/sugar.min.js"></script>
<script src="../../bower_components/sugar/dist/locales/es.js"></script>
<dom-module id="turnos-app">
  <template>
    <style>
       :host {
        display: block;
      }

      paper-button {
        font-family: 'Roboto', 'Noto', sans-serif;
        font-weight: normal;
        font-size: 14px;
        -webkit-font-smoothing: antialiased;
      }

      paper-button.pink {
        color: var(--paper-pink-a200);
        --paper-button-ink-color: var(--paper-pink-a200);
      }

      paper-button.pink:hover {
        background-color: var(--paper-pink-100);
      }

      paper-button.indigo {
        background-color: var(--paper-indigo-500);
        color: white;
        --paper-button-raised-keyboard-focus: {
          background-color: var(--paper-pink-a200) !important;
          color: white !important;
        }
        ;
      }

      paper-button.indigo:hover {
        background-color: var(--paper-indigo-400);
      }

      paper-button.green {
        background-color: var(--paper-green-500);
        color: white;
      }

      paper-button.green[active] {
        background-color: var(--paper-red-500);
      }

      paper-button.disabled {
        color: white;
      }

      .container {
        text-align: center;
      }
    </style>
    <h2>Gestor de Turnos</h2>
    <paper-button toggles raised class="indigo" id="openTurno">Agregar Turno</paper-button>
    <paper-button toggles raised class="green" id="addCliente">Agregar Cliente</paper-button>
    <events-calendar id="calendar" day-labels='["Do","Lu","Ma","Mi","Ju","Vi","Sa"]' show-days-in-month=35 event-list={{eventList}}>
    </events-calendar>
    <paper-dialog id="dialogTurno" entry-animation="scale-up-animation" exit-animation="fade-out-animation" with-backdrop>
      <!--<div class="contenedor">
        <vaadin-date-picker label="Fecha del Turno" id="fecha_turno">
        </vaadin-date-picker>
      </div>-->
      <div class="container">
        <paper-datetime-picker-item id="datetime" icon="icons:today" placeholder="Fecha y hora del turno" date-format='LL' time-format="LT a"
          locale="es"></paper-datetime-picker-item>

        <paper-dropdown-menu label="Categoría" id="categoria">
          <paper-listbox slot="dropdown-content" selected="1">
            <paper-item>Corte</paper-item>
            <paper-item>Color - Tintura</paper-item>
            <paper-item>Masajes</paper-item>
            <paper-item>Depilación</paper-item>
          </paper-listbox>
        </paper-dropdown-menu>

        <paper-dropdown-menu label="Profesional" id="profesional">
          <paper-listbox slot="dropdown-content" selected="1">
            <paper-item>Laura</paper-item>
            <paper-item>Cristian</paper-item>
            <paper-item>Juan</paper-item>
            <paper-item>Titi</paper-item>
          </paper-listbox>
        </paper-dropdown-menu>

        <paper-dropdown-menu label="Cliente" id="cliente">
          <paper-listbox slot="dropdown-content" selected="1">
            <paper-item>Sra. Lopez - </paper-item>
            <paper-item>Sr. Amieva</paper-item>
            <paper-item>Sra. Preda</paper-item>
            <paper-item>Sra. Lucero</paper-item>
          </paper-listbox>
        </paper-dropdown-menu>
      </div>

      <!--<paper-input id="cost" name="cost" label="Costo" type="number" step="01.00" placeholder='00.00' required>
        <div suffix>horas</div>
      </paper-input>-->
      <div class="buttons">
        <paper-button dialog-dismiss>Cancelar</paper-button>
        <paper-button dialog-confirm autofocus id="addTurno">Agregar</paper-button>
      </div>
    </paper-dialog>
  </template>
  <script>
    Polymer({

      is: 'turnos-app',

      properties: {
        prop1: {
          type: String,
          value: 'turnos-app',
        },
        time: {
          type: String
        },
        eventList:{
          type: Object,
          value: {}
        }
      },
      listeners: {
        // 'calendar.dateSelected': '_dateSelected',
        'addCliente.tap': '_dateSelected',
        'openTurno.tap': '_dialogTurno',
        'addTurno.tap': '_addTurno'

      },
      ready: function () {
        this.$.datetime.cancelButton = 'Cancelar'
        this.$.datetime.okButton = 'Aceptar'

        // this.$.timePicker.style.display = 'none'
        // Sugar.Date.setLocale('es');
        // let datepicker = this.$.fecha_turno;
        // datepicker.i18n = {
        //   week: 'semana',
        //   calendar: 'calendario',
        //   clear: 'limpiar',
        //   today: 'hoy',
        //   cancel: 'cancelar',
        //   firstDayOfWeek: 0,
        //   monthNames: 'enero_febrero_marzo_abril_mayo_junio_julio_agosto_septiembre_octubre_noviembre_diciembre'
        //     .split('_'),
        //   weekdays: 'domingo_lunes_martes_miercoles_jueves_viernes_sabado'.split('_'),
        //   weekdaysShort: 'do_lu_ma_mi_ju_vi_sa'.split('_'),
        //   formatDate: function (date) {
        //     return Sugar.Date.format(date, '{short}');
        //   },
        //   formatTitle: function (monthName, fullYear) {
        //     return monthName + ' ' + fullYear;
        //   },
        //   parseDate: function (dateString) {
        //     var matches = datepicker.i18n.monthNames.filter(function (monthName) {
        //       return monthName.toLowerCase().startsWith(dateString.trim().toLowerCase());
        //     });
        //     dateString = matches.length === 1 ? matches[0] : dateString;
        //     // Parse the date
        //     return Sugar.Date.create(dateString);
        //   }
        // };


        var calendar = document.querySelector('events-calendar');

        // this.eventList = {
        //   '2017-06-01': [{
        //       summary: '7-11 | S',
        //       slot: '7:00-11:00',
        //       name: 'Rocio',
        //       category: 'Cortes',
        //     },
        //     {
        //       summary: '11-15 | Santiago',
        //       slot: '11:00-15:00',
        //       name: 'Marco',
        //       category: 'Masajes'
        //     }
        //   ],
        //   '2017-05-31': [{
        //       summary: '7-11 | S',
        //       slot: '7:00-11:00',
        //       name: '',
        //       category: 'Carlos',
        //     },
        //     {
        //       summary: '11-15 | Santiago',
        //       slot: '11:00-15:00',
        //       name: 'Marco',
        //       category: 'Supervisor'
        //     }
        //   ],
        //   '2017-06-02': [{
        //     summary: '7-11 | S',
        //     slot: '7:00-11:00',
        //     name: '',
        //     category: 'Supervisor'
        //   }],
        //   '2017-06-03': [{
        //     summary: '7-aaaa11 | S',
        //     slot: '7:00-11:00',
        //     name: '',
        //     category: 'Supervisor'
        //   }],
        // };
        // this.$.calendar.addEventListener("date-selected", this._dialogTurno.bind(this))
      },
      _dialogTurno: function (e) {
        // console.log("dia", e.detail.date);
        this.$.dialogTurno.open();
        // this.$.dialog.open();
        // this.$.timePicker.style.display = 'inline-block'
        // this.$.timePicker.style.margin = 0;
        // this.$.timePicker.style.position = 'absolute'
        // this.$.timePicker.style.zIndex = 9999;

      },
      _addTurno: function(){
        let fecha = moment(this.$.datetime.date).format('YYYY-MM-DD').toString();
        let list = this.eventList;
        let obj = {};
        obj.category = this.$.categoria.value;
        obj.name = this.$.profesional.value;
        obj.summary = this.$.cliente.value;
        obj.slot = moment(this.$.datetime.date).format('LT');

        if(!list[fecha]){
          list[fecha]= new Array;
        } 
        list[fecha].push(obj);
        // this.$.calendar.eventList = list.eventList;
        console.log(JSON.stringify(this.$.calendar.eventList));

      }

    });
  </script>
</dom-module>